# é¡¹ç›®æŠ€æœ¯æ¶æ„æ–‡æ¡£

## ğŸ—ï¸ æ€»ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Weather Agent with Generative UI            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Frontend      â”‚    Backend      â”‚       Configuration        â”‚
â”‚                 â”‚                 â”‚                             â”‚
â”‚ ui.tsx          â”‚ graph.py        â”‚ langgraph.json             â”‚
â”‚ React Component â”‚ LangGraph Agent â”‚ pyproject.toml             â”‚
â”‚ TypeScript      â”‚ Python 3.11+    â”‚ Makefile                   â”‚
â”‚ CSS Animations  â”‚ Async/Await     â”‚ .python-version            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ§  æ ¸å¿ƒç®—æ³•ï¼šä¸¤å±‚åŸå¸‚æå–

### ç®—æ³•è®¾è®¡ç†å¿µ
- **æ€§èƒ½ä¼˜å…ˆ**: ç›´æ¥å­—ç¬¦ä¸²åŒ¹é…å¿«é€Ÿå¤„ç†å¸¸è§åœºæ™¯
- **æ™ºèƒ½åå¤‡**: æ­£åˆ™è¡¨è¾¾å¼å¤„ç†å¤æ‚è‡ªç„¶è¯­è¨€
- **åŠ¨æ€é€‚åº”**: è‡ªåŠ¨ä»æ•°æ®é›†è·å–æ”¯æŒåŸå¸‚åˆ—è¡¨
- **ä½ç½®ä¼˜å…ˆ**: å¤šåŸå¸‚å‡ºç°æ—¶è¿”å›æœ€å…ˆå‡ºç°çš„åŸå¸‚

### å®ç°ç»†èŠ‚

```python
def extract_city_from_message(message_content: str) -> str:
    """ä¼˜åŒ–çš„ä¸¤å±‚åŸå¸‚æå–ç®—æ³•"""
    
    # åŠ¨æ€è·å–æ”¯æŒçš„åŸå¸‚åˆ—è¡¨
    available_cities = {w["city"] for w in WEATHER_DATA}
    
    # ç¬¬ä¸€å±‚: ç›´æ¥åŒ¹é… - æŒ‰ä½ç½®æ’åº (æœ€å¿«)
    city_positions = []
    for city in available_cities:
        pos = message_content.find(city)
        if pos != -1:
            city_positions.append((pos, city))
    
    if city_positions:
        # è¿”å›æœ€å…ˆå‡ºç°çš„åŸå¸‚
        city_positions.sort(key=lambda x: x[0])
        return city_positions[0][1]
    
    # ç¬¬äºŒå±‚: åŸºæœ¬æ­£åˆ™æ¨¡å¼åŒ¹é… (æ ¸å¿ƒåœºæ™¯è¦†ç›–)
    basic_patterns = [
        r"(?:æŸ¥è¯¢|æŸ¥çœ‹|äº†è§£)(.+?)(?:çš„)?(?:å¤©æ°”|æ¸©åº¦)",     # "æŸ¥è¯¢åŒ—äº¬çš„å¤©æ°”"
        r"(.+?)(?:çš„)?(?:å¤©æ°”|æ¸©åº¦)(?:å¦‚ä½•|æ€ä¹ˆæ ·)",        # "åŒ—äº¬çš„å¤©æ°”å¦‚ä½•"
        r"(.+?)(?:å¤©æ°”|æ¸©åº¦)"                             # "åŒ—äº¬å¤©æ°”"
    ]
    
    for pattern in basic_patterns:
        match = re.search(pattern, message_content)
        if match:
            potential_city = match.group(1).strip()
            # æ£€æŸ¥æå–çš„åŸå¸‚æ˜¯å¦åœ¨æ”¯æŒåˆ—è¡¨ä¸­
            for city in available_cities:
                if city in potential_city:
                    return city
    
    return None
```

### æ€§èƒ½ç‰¹æ€§
- **æ—¶é—´å¤æ‚åº¦**: ç¬¬ä¸€å±‚ O(n*m)ï¼Œç¬¬äºŒå±‚ O(k*m) (n=åŸå¸‚æ•°ï¼Œm=æ¶ˆæ¯é•¿åº¦ï¼Œk=æ­£åˆ™æ¨¡å¼æ•°)
- **ç©ºé—´å¤æ‚åº¦**: O(n) (åŸå¸‚ä½ç½®å­˜å‚¨)
- **æˆåŠŸç‡**: æµ‹è¯•æ˜¾ç¤º 100% è¯†åˆ«ç‡ (28/28 æµ‹è¯•ç”¨ä¾‹é€šè¿‡)

## ğŸ“Š æ•°æ®æµæ¶æ„

### æ¶ˆæ¯æµå¤„ç†

```
User Input (HumanMessage)
        â†“
extract_city_from_message()
        â†“
City Match/Default Selection
        â†“
WEATHER_DATA Lookup
        â†“
WeatherOutput Generation
        â†“
AI Message + UI Component
        â†“
Frontend Rendering
```

### çŠ¶æ€ç®¡ç†

```python
class AgentState(TypedDict):
    """Agent state with messages and UI components."""
    messages: Annotated[Sequence[BaseMessage], add_messages]
    ui: Annotated[Sequence[AnyUIMessage], ui_message_reducer]

class WeatherOutput(TypedDict):
    """Weather output with complete weather information."""
    city: str
    temperature: str
    condition: str
    humidity: str
    windSpeed: str  # ç»Ÿä¸€ä½¿ç”¨windSpeedï¼ˆä¸å‰ç«¯å¯¹é½ï¼‰
    description: str
```

## ğŸ¨ å‰ç«¯æ¶æ„

### React ç»„ä»¶è®¾è®¡

```typescript
interface WeatherProps {
  city: string;           // åŸå¸‚åç§°
  temperature: string;    // æ¸©åº¦ "22Â°C"
  condition: string;      // å¤©æ°”çŠ¶å†µ "æ™´å¤©"
  humidity: string;       // æ¹¿åº¦ "45%"
  windSpeed: string;      // é£é€Ÿ "3km/h" (ç»Ÿä¸€å­—æ®µå)
  description: string;    // è¯¦ç»†æè¿°
}

const WeatherComponent = (props: WeatherProps) => {
  // åŠ¨æ€å›¾æ ‡æ˜ å°„
  const weatherIcon = getWeatherIcon(props.condition);
  
  // èƒŒæ™¯æ¸å˜æ˜ å°„
  const gradient = getBackgroundGradient(props.condition);
  
  // å…¥åœºåŠ¨ç”»æ§åˆ¶
  const [isVisible, setIsVisible] = useState(false);
  
  return (
    <div className={`weather-card ${isVisible ? 'visible' : ''}`}>
      {/* åŠ¨ç”»å’Œæ¸å˜æ•ˆæœ */}
    </div>
  );
};
```

### UI ç‰¹æ€§å®ç°

#### åŠ¨ç”»ç³»ç»Ÿ
- **å…¥åœºåŠ¨ç”»**: `translateY(50px) â†’ translateY(0)` é…åˆé€æ˜åº¦æ¸å˜
- **å›¾æ ‡åŠ¨ç”»**: `bounce` å…³é”®å¸§åŠ¨ç”»ï¼Œ2ç§’å¾ªç¯
- **èƒŒæ™¯å…ƒç´ **: äº‘æœµæµ®åŠ¨ã€æ˜Ÿæ˜Ÿé—ªçƒåŠ¨ç”»
- **å“åº”å¼**: ç§»åŠ¨ç«¯è‡ªé€‚åº”ç¼©æ”¾

#### è§†è§‰æ˜ å°„
```typescript
const weatherIconMap = {
  'æ™´å¤©': 'â˜€ï¸',
  'å¤šäº‘': 'â›…', 
  'é˜´å¤©': 'â˜ï¸',
  'å°é›¨': 'ğŸŒ§ï¸',
  'å¤§é›¨': 'ğŸŒ§ï¸',
  'é›ª': 'â„ï¸',
  'é›¾': 'ğŸŒ«ï¸'
};

const gradientMap = {
  'æ™´å¤©': 'linear-gradient(135deg, #fdcb6e 0%, #e17055 100%)',
  'å¤šäº‘': 'linear-gradient(135deg, #74b9ff 0%, #0984e3 100%)',
  'å°é›¨': 'linear-gradient(135deg, #636e72 0%, #2d3436 100%)'
  // ...æ›´å¤šæ¸å˜å®šä¹‰
};
```

## ğŸ§ª æµ‹è¯•æ¶æ„

### æµ‹è¯•é‡‘å­—å¡”

```
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Integration    â”‚  â† End-to-end tests
              â”‚     Tests       â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚     Unit Tests           â”‚  â† 34 tests (100% pass)
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
         â”‚   â”‚ Message Parsing  â”‚   â”‚  â† 10 tests
         â”‚   â”‚ Weather Node     â”‚   â”‚  â† 8 tests  
         â”‚   â”‚ UI Data         â”‚   â”‚  â† 12 tests
         â”‚   â”‚ Configuration   â”‚   â”‚  â† 4 tests
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æµ‹è¯•ç­–ç•¥

#### å•å…ƒæµ‹è¯•è¦†ç›–
- **æ¶ˆæ¯è§£ææµ‹è¯•**: éªŒè¯æ‰€æœ‰è‡ªç„¶è¯­è¨€æ¨¡å¼è¯†åˆ«
- **å¤©æ°”èŠ‚ç‚¹æµ‹è¯•**: å¼‚æ­¥åŠŸèƒ½ã€é”™è¯¯å¤„ç†ã€åŸå¸‚æå–
- **UIæ•°æ®æµ‹è¯•**: æ•°æ®ç»“æ„éªŒè¯ã€å­—æ®µä¸€è‡´æ€§ã€JSONåºåˆ—åŒ–
- **é…ç½®æµ‹è¯•**: AgentStateç»“æ„ã€å›¾ç¼–è¯‘éªŒè¯

#### é”™è¯¯å¤„ç†æµ‹è¯•
```python
# æµ‹è¯•LangGraphä¸Šä¸‹æ–‡ç¼ºå¤±çš„å¤„ç†
try:
    push_ui_message("weather", dict(weather_output), message=message)
except RuntimeError as e:
    # åœ¨æµ‹è¯•æˆ–é LangGraph ä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ—¶ï¼Œè·³è¿‡ UI æ¶ˆæ¯æ¨é€
    if "runnable context" not in str(e):
        raise
```

## ğŸ”§ å·¥å…·é“¾æ¶æ„

### æ™ºèƒ½å·¥å…·é€‰æ‹©

```makefile
# è‡ªåŠ¨æ£€æµ‹å¹¶ä¼˜å…ˆä½¿ç”¨æ€§èƒ½æ›´å¥½çš„å·¥å…·
PYTHON_CMD := $(shell command -v uv >/dev/null 2>&1 && echo "uv run" || echo "python -m")

test:
	$(PYTHON_CMD) pytest tests/unit_tests/

format:
	$(PYTHON_CMD) ruff format src/ tests/
	
lint:
	$(PYTHON_CMD) ruff check src/ tests/
	$(PYTHON_CMD) mypy src/
```

### ä¾èµ–ç®¡ç†

#### æ ¸å¿ƒè¿è¡Œæ—¶ä¾èµ–
- **LangGraph**: >=0.2.6 (çŠ¶æ€å›¾å¼•æ“)
- **LangChain Core**: >=0.3.0 (æ¶ˆæ¯å¤„ç†)
- **Python**: >=3.11 (ç°ä»£Pythonç‰¹æ€§)

#### å¼€å‘å·¥å…·ä¾èµ–
- **pytest**: >=8.3.5 (æµ‹è¯•æ¡†æ¶)
- **mypy**: >=1.13.0 (ç±»å‹æ£€æŸ¥)
- **ruff**: >=0.8.2 (ä»£ç æ ¼å¼åŒ–å’Œæ£€æŸ¥)

## ğŸš€ éƒ¨ç½²æ¶æ„

### å¼€å‘ç¯å¢ƒ
```bash
# å¿«é€Ÿå¯åŠ¨å¼€å‘ç¯å¢ƒ
uv sync --group dev           # å®‰è£…æ‰€æœ‰ä¾èµ–
uv run langgraph dev         # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
uv run python examples/weather_demo.py  # è¿è¡Œæ¼”ç¤º
```

### ç”Ÿäº§ç¯å¢ƒç‰¹æ€§
- **é™æ€æ•°æ®**: æ— éœ€å¤–éƒ¨APIï¼Œå‡å°‘æ•…éšœç‚¹
- **å¿«é€Ÿå“åº”**: ä¼˜åŒ–ç®—æ³•ç¡®ä¿<100mså“åº”æ—¶é—´
- **å®¹é”™æœºåˆ¶**: å¤šå±‚é”™è¯¯å¤„ç†å’Œä¼˜é›…é™çº§
- **èµ„æºæ•ˆç‡**: æœ€å°åŒ–å†…å­˜å ç”¨å’ŒCPUæ¶ˆè€—

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### ç®—æ³•ä¼˜åŒ–
- **ç›´æ¥åŒ¹é…ä¼˜å…ˆ**: å¸¸è§æŸ¥è¯¢èµ°æœ€å¿«è·¯å¾„
- **æ­£åˆ™è¡¨è¾¾å¼ç¼“å­˜**: ç¼–è¯‘åçš„æ­£åˆ™æ¨¡å¼é‡ç”¨
- **æ—©æœŸè¿”å›**: æ‰¾åˆ°åŒ¹é…å³è¿”å›ï¼Œé¿å…ä¸å¿…è¦è®¡ç®—

### UIæ€§èƒ½
- **CSSç¡¬ä»¶åŠ é€Ÿ**: `transform` å’Œ `opacity` åŠ¨ç”»
- **å“åº”å¼å›¾ç‰‡**: æ ¹æ®è®¾å¤‡é€‚é…èµ„æºåŠ è½½
- **ç»„ä»¶æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½å‡å°‘åˆå§‹åŠ è½½æ—¶é—´

### å†…å­˜ç®¡ç†
- **æ•°æ®ç»“æ„ä¼˜åŒ–**: ä½¿ç”¨ TypedDict å‡å°‘å†…å­˜å¼€é”€
- **ç¼“å­˜ç­–ç•¥**: ç¼–è¯‘æ—¶ä¼˜åŒ–å’Œè¿è¡Œæ—¶ç¼“å­˜å¹³è¡¡
- **åƒåœ¾å›æ”¶å‹å¥½**: é¿å…å¾ªç¯å¼•ç”¨å’Œå†…å­˜æ³„æ¼

## ğŸ”® æ‰©å±•æ€§è®¾è®¡

### æ°´å¹³æ‰©å±•
- **åŸå¸‚æ•°æ®**: é€šè¿‡ä¿®æ”¹ `WEATHER_DATA` æ•°ç»„è½»æ¾æ·»åŠ æ–°åŸå¸‚
- **è¯­è¨€æ¨¡å¼**: åœ¨ `basic_patterns` ä¸­æ·»åŠ æ–°çš„æ­£åˆ™è¡¨è¾¾å¼
- **UIç»„ä»¶**: æ¨¡å—åŒ–è®¾è®¡æ”¯æŒåŠŸèƒ½æ‰©å±•

### å‚ç›´æ‰©å±•
- **å¤šè¯­è¨€æ”¯æŒ**: æ¶æ„æ”¯æŒå›½é™…åŒ–æ‰©å±•
- **å¤–éƒ¨API**: å¯æ›¿æ¢é™æ€æ•°æ®ä¸ºå®æ—¶APIè°ƒç”¨
- **å¤æ‚äº¤äº’**: æ”¯æŒå¤šè½®å¯¹è¯å’Œä¸Šä¸‹æ–‡è®°å¿†

è¿™ä¸ªæ¶æ„è®¾è®¡å…¼é¡¾äº†æ€§èƒ½ã€å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œç”¨æˆ·ä½“éªŒï¼Œä¸ºæ„å»ºç°ä»£åŒ–çš„AIå¯¹è¯åº”ç”¨æä¾›äº†åšå®çš„æŠ€æœ¯åŸºç¡€ã€‚